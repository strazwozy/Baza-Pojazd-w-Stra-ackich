<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>üöí Baza woz√≥w stra≈ºackich</title>
<style>
* { box-sizing: border-box; margin:0; padding:0; }
html, body { width:100%; font-family: Arial; background:#1a1a1a; color:white; padding:20px; }

/* Nag≈Ç√≥wek */
h1 { text-align:center; margin-bottom:20px; font-size:32px; }

/* Filtry i sortowanie */
#search, #filterWoj, #sortBy {
    margin:10px 5px; padding:5px; font-size:16px; border-radius:6px; border:1px solid #ccc;
}
#sortBy { background:#b30000; color:white; }

/* Lista woz√≥w */
#lista { display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin-bottom:20px; }
.woz { background:#2a2a2a; padding:10px; border-radius:8px; display:flex; flex-direction: column; align-items:center; width:200px; box-shadow:0 2px 5px rgba(0,0,0,0.5); cursor:pointer; transition:transform 0.2s; }
.woz:hover { transform:scale(1.05); }
.woz img { width:180px; height:120px; object-fit:cover; border-radius:6px; margin-bottom:10px; }
.woz-info { display:flex; flex-direction: column; gap:5px; text-align:left; width:100%; }
.woz-info strong { display:inline-block; width:90px; }

/* Status */
.status { font-weight:bold; }

/* Stronicowanie */
#pagination { display:flex; justify-content:center; gap:10px; margin-bottom:20px; flex-wrap:wrap; }
.page-btn { padding:8px 12px; border-radius:6px; border:none; cursor:pointer; background:#b30000; color:white; }
.page-btn.disabled { background:#555; cursor:default; }

/* Lightbox */
#lightbox {
    display:none; position:fixed; top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.95); justify-content:center; align-items:center; z-index:1000;
}
#lightboxContent {
    background:#1a1a1a;
    display:flex; flex-direction:row; width:95%; max-width:1600px; height:95%; border-radius:15px; overflow:hidden; color:white; position:relative; box-shadow:0 0 20px rgba(0,0,0,0.6);
}
#lightboxImg { max-width:80%; max-height:100%; object-fit:contain; background:#000; }
#lightboxInfo { flex:1; display:flex; flex-direction:column; overflow-y:auto; background:#1a1a1a; }
#lightboxTitle { background:#E60000; padding:15px; font-size:28px; text-align:center; width:100%; flex-shrink:0; font-weight:bold; }
#lightboxDetails { padding:15px; flex:1; font-size:16px; display:flex; flex-direction:column; gap:8px; overflow-y:auto; }
.detail-row { display:flex; justify-content:space-between; padding:5px 0; border-bottom:1px solid rgba(255,255,255,0.2); }
.detail-label { font-weight:bold; min-width:130px; }
.detail-value { flex-grow:1; }

/* Lightbox przyciski */
#closeLightbox {
    position:absolute;
    top:10px;
    right:15px;
    font-size:32px;
    font-weight:bold;
    color:white;
    background:#b30000;
    border-radius:50%;
    width:40px;
    height:40px;
    display:flex;
    justify-content:center;
    align-items:center;
    cursor:pointer;
    z-index:1001;
}
#closeLightbox:hover { background:#ff1a1a; }

#prevBtn, #nextBtn { position:absolute; top:50%; transform:translateY(-50%); font-size:50px; color:white; background: rgba(0,0,0,0.4); border:none; padding:20px; cursor:pointer; border-radius:50%; z-index:1001; }
#prevBtn { left:10px; } #nextBtn { right:10px; }

/* Responsywno≈õƒá */
@media (max-width:1000px){
  #lightboxContent { flex-direction: column; width:95%; height:90%; }
  #lightboxImg { max-width:100%; max-height:50%; }
  #prevBtn, #nextBtn { font-size:30px; padding:10px; }
  #lista { flex-direction:column; align-items:center; }
}
.osp-link {
    text-decoration: underline;
    cursor: pointer;
    color: inherit; /* <- dziedziczy kolor tekstu zamiast byƒá niebieski/fioletowy */
}

</style>
</head>
<body>

<h1>üöí Baza woz√≥w stra≈ºackich</h1>

<input type="text" id="search" placeholder="Szukaj jednostki, ID, rejestracji, marki...">
<select id="filterWoj">
  <option value="">Wszystkie wojew√≥dztwa</option>
  <option value="Ma≈Çopolskie">Ma≈Çopolskie</option>
  <option value="Mazowieckie">Mazowieckie</option>
  <option value="Pomorskie">Pomorskie</option>
  <option value="Wielkopolskie">Wielkopolskie</option>
  <option value="Dolno≈õlƒÖskie">Dolno≈õlƒÖskie</option>
  <option value="≈ölƒÖskie">≈ölƒÖskie</option>
  <option value="≈Å√≥dzkie">≈Å√≥dzkie</option>
  <option value="Lubelskie">Lubelskie</option>
  <option value="Lubuskie">Lubuskie</option>
  <option value="Opolskie">Opolskie</option>
  <option value="Podkarpackie">Podkarpackie</option>
  <option value="Podlaskie">Podlaskie</option>
  <option value="≈öwiƒôtokrzyskie">≈öwiƒôtokrzyskie</option>
  <option value="Warmi≈Ñsko-Mazurskie">Warmi≈Ñsko-Mazurskie</option>
  <option value="Zachodniopomorskie">Zachodniopomorskie</option>
</select>

<select id="sortBy">
  <option value="ID">Sortuj po ID</option>
  <option value="Jednostka">Sortuj po Jednostce</option>
  <option value="Marka">Sortuj po Marce</option>
  <option value="Rejestracja">Sortuj po Rejestracji</option>
  <option value="Rok produkcji">Sortuj po Roku</option>
</select>

<div id="lista"></div>
<div id="pagination"></div>

<!-- Lightbox -->
<div id="lightbox">
  <button id="prevBtn">&#8592;</button>
  <div id="lightboxContent">
      <span id="closeLightbox">&times;</span>
      <img id="lightboxImg" src="">
      <div id="lightboxInfo">
          <h2 id="lightboxTitle">Marka</h2>
          <div id="lightboxDetails"></div>
      </div>
  </div>
  <button id="nextBtn">&#8594;</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<script>
const csvUrl = 'https://docs.google.com/spreadsheets/d/1-INf04fbUF_z3l7kUvIr4dm1lv7iJWMVmw-ICWbDfkI/export?format=csv';
let currentPage = 1;
const itemsPerPage = 80;
let filteredWozki = [];
let lightboxIndex = 0;
let filterField = null; // globalna zmienna do klikanych filtr√≥w

// Pobranie danych CSV
Papa.parse(csvUrl, { download:true, header:true, skipEmptyLines:true, complete:function(results){
    window.wozy = results.data;
    displayWozow();
}});

function getStatusColor(status){
    if(!status) return 'white';
    const s=status.toLowerCase();
    if(s==='czynny') return 'green';
    if(['wycofany ze s≈Çu≈ºby','sprzedany','rozbity','sp≈ÇonƒÖ≈Ç'].includes(s)) return 'red';
    if(s==='przeniesiony') return 'yellow';
    if(s==='obiekt muzeum') return 'blue';
    if(s==='porzucony') return 'orange';
    return 'white';
}

function displayWozow(){
    const lista=document.getElementById('lista');
    const pagination=document.getElementById('pagination');
    const searchValue=document.getElementById('search').value.toLowerCase();
    const wojFilter=document.getElementById('filterWoj').value;
    const sortBy=document.getElementById('sortBy').value;
    lista.innerHTML=''; pagination.innerHTML='';

    // Sortowanie
    window.wozy.sort((a,b)=>{
        const valA=(a[sortBy]||'').toString().toLowerCase();
        const valB=(b[sortBy]||'').toString().toLowerCase();
        return valA.localeCompare(valB, undefined, {numeric:true});
    });

    filteredWozki = window.wozy.filter(w=>{
        let searchMatch = true;
        if(searchValue){
            if(filterField && w[filterField]){
                searchMatch = w[filterField].toString().toLowerCase().includes(searchValue);
            } else {
                searchMatch =
                    (w.Jednostka && w.Jednostka.toLowerCase().includes(searchValue)) ||
                    (w.ID && w.ID.toLowerCase().includes(searchValue)) ||
                    (w.Rejestracja && w.Rejestracja.toLowerCase().includes(searchValue)) ||
                    (w.Marka && w.Marka.toLowerCase().includes(searchValue));
            }
        }
        return searchMatch && (wojFilter==='' || w.Wojew√≥dztwo===wojFilter);
    });

    const totalPages=Math.ceil(filteredWozki.length/itemsPerPage);
    if(currentPage>totalPages) currentPage=totalPages||1;

    const start=(currentPage-1)*itemsPerPage;
    const end=start+itemsPerPage;
    const pageItems=filteredWozki.slice(start,end);

    pageItems.forEach((w,i)=>{
        const div=document.createElement('div'); div.className='woz';
        div.innerHTML=`
            <img src="${w.Zdjƒôcie||'https://via.placeholder.com/180x120?text=Brak+zdjƒôcia'}" alt="${w.Jednostka}">
            <div class="woz-info">
                <strong>ID:</strong> ${w.ID||'-'}
                <strong>Jednostka:</strong> ${w.Jednostka||'-'}
                <strong>Marka:</strong> ${w.Marka||'-'}
                <strong>Rok:</strong> ${w['Rok produkcji']||'-'}
                <strong>Status:</strong> <span class="status" style="color:${getStatusColor(w.Status)}">${w.Status||'-'}</span>
            </div>
        `;
        lista.appendChild(div);
        div.addEventListener('click',()=>openLightbox(start+i));
    });

    // Stronicowanie
    if(totalPages>1){
        const prev=document.createElement('button'); prev.textContent='Prev'; prev.className='page-btn'; if(currentPage===1){prev.disabled=true; prev.classList.add('disabled');}
        prev.addEventListener('click',()=>{ currentPage--; displayWozow(); });
        pagination.appendChild(prev);

        for(let p=1;p<=totalPages;p++){
            const btn=document.createElement('button'); btn.textContent=p; btn.className='page-btn'; if(p===currentPage) btn.classList.add('disabled');
            btn.addEventListener('click',()=>{ currentPage=p; displayWozow(); });
            pagination.appendChild(btn);
        }

        const next=document.createElement('button'); next.textContent='Next'; next.className='page-btn'; if(currentPage===totalPages){next.disabled=true; next.classList.add('disabled');}
        next.addEventListener('click',()=>{ currentPage++; displayWozow(); });
        pagination.appendChild(next);
    }
}

document.getElementById('search').addEventListener('input',()=>{ currentPage=1; filterField=null; displayWozow(); });
document.getElementById('filterWoj').addEventListener('change',()=>{ currentPage=1; displayWozow(); });
document.getElementById('sortBy').addEventListener('change',()=>{ displayWozow(); });

// Lightbox
const lightbox=document.getElementById('lightbox');
const lbImg=document.getElementById('lightboxImg');
const lbTitle=document.getElementById('lightboxTitle');
const lbDetails=document.getElementById('lightboxDetails');
const closeBtn=document.getElementById('closeLightbox');
const prevBtn=document.getElementById('prevBtn');
const nextBtn=document.getElementById('nextBtn');

    function openLightbox(idx){
    lightboxIndex = idx;
    if(lightboxIndex < 0) lightboxIndex = filteredWozki.length - 1;
    if(lightboxIndex >= filteredWozki.length) lightboxIndex = 0;
    const w = filteredWozki[lightboxIndex];

    lbImg.src = w.Zdjƒôcie || 'https://via.placeholder.com/800x600?text=Brak+zdjƒôcia';
    lbTitle.textContent = `${w.Marka||'-'} (${w.ID||'-'})`;
    lbDetails.innerHTML = '';

    const sections = [
        {title:'üö® Podstawowe dane', fields:['ID','Marka','Rok produkcji','Rejestracja','Typ']},
        {title:'üìç Lokalizacja', fields:['Jednostka','Wojew√≥dztwo','Powiat']},
        {title:'‚ö° Status', fields:['Status']},
        {title:'üìù Inne', fields:['Inne']}
    ];

    sections.forEach(sec=>{
        const secDiv = document.createElement('div');

        // Pokazujemy nag≈Ç√≥wek sekcji zawsze
        const secHeader = document.createElement('h3');
        secHeader.innerHTML = sec.title;
        secDiv.appendChild(secHeader);

        sec.fields.forEach(f=>{
            if(w[f]){
                const row = document.createElement('div'); row.className='detail-row';
                const label = document.createElement('div'); label.className='detail-label'; label.textContent=f+':';
                const value = document.createElement('div'); value.className='detail-value';

                if(f==='Status'){
                    value.style.color = getStatusColor(w[f]);
                    value.textContent = w[f];
                } else if(f !== 'Inne'){
                    value.textContent = w[f];
                }

                // Klikalne warto≈õci dla podstawowych filtr√≥w
                const clickableFields = ['ID','Rejestracja','Wojew√≥dztwo','Powiat','Rok produkcji','Jednostka'];
                if(clickableFields.includes(f)){
                    value.style.textDecoration='underline';
                    value.style.cursor='pointer';
                    value.addEventListener('click',()=>{
                        document.getElementById('search').value = w[f];
                        filterField = f;
                        currentPage=1; displayWozow();
                        lightbox.style.display='none';
                        history.pushState({search:w[f], field:f}, "", "");
                    });
                }

                // Sekcja Inne ‚Äì tylko nazwy jednostek sƒÖ klikane
if(f==='Inne'){
    const text = w[f];

    // Regex dla OSP + dodatkowych skr√≥t√≥w
    const unitRegex = /\b(?:OSP|JRG|PSP|ZSP|WSP|LSRG|ZSR|KSRG)\s+[\w\sƒÖƒô≈Ç√≥≈Ñ≈º≈∫ƒá]+/gi;

    const newText = text.replace(unitRegex, match => `<span class="osp-link">${match}</span>`);
    value.innerHTML = newText;

    value.querySelectorAll('.osp-link').forEach(el=>{
        el.addEventListener('click',()=>{
            // Usuwamy tylko skr√≥t i spacje z przodu
            const ospName = el.textContent.replace(/^(OSP|JRG|PSP|ZSP|WSP|LSRG|ZSR|KSRG)\s+/i,'').trim();
            document.getElementById('search').value = ospName;
            filterField='Jednostka';
            currentPage=1; displayWozow();
            lightbox.style.display='none';
            history.pushState({search:ospName, field:'Jednostka'}, "", "");
        });
    });
}


                row.appendChild(label); row.appendChild(value);
                secDiv.appendChild(row);
            }
        });

        lbDetails.appendChild(secDiv);
    });

    lightbox.style.display='flex';
}

closeBtn.addEventListener('click',()=>lightbox.style.display='none');
prevBtn.addEventListener('click',()=>openLightbox(lightboxIndex-1));
nextBtn.addEventListener('click',()=>openLightbox(lightboxIndex+1));

document.addEventListener('keydown',e=>{
    if(lightbox.style.display==='flex'){
        if(e.key==='ArrowLeft') openLightbox(lightboxIndex-1);
        if(e.key==='ArrowRight') openLightbox(lightboxIndex+1);
        if(e.key==='Escape') lightbox.style.display='none';
    }
});

// Obs≈Çuga wstecz/prz√≥d w przeglƒÖdarce
window.onpopstate = function(event){
    if(event.state){
        document.getElementById('search').value = event.state.search || '';
        filterField = event.state.field || null;
        currentPage = 1;
        displayWozow();
    }
};
</script>
</body>
</html>
