<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>ðŸš’ Baza wozÃ³w straÅ¼ackich</title>

<style>
* { box-sizing: border-box; margin:0; padding:0; }
html, body { width:100%; font-family: Arial; background:#1a1a1a; color:white; padding:20px; }

h1 { text-align:center; margin-bottom:20px; font-size:32px; }

#search, #filterWoj, #sortBy, #sortDir {
    margin:10px 5px;
    padding:5px;
    font-size:16px;
    border-radius:6px;
    border:1px solid #ccc;
}
#sortBy, #sortDir { background:#b30000; color:white; }

#lista { display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin-bottom:20px; }
.woz {
    background:#2a2a2a;
    padding:10px;
    border-radius:8px;
    display:flex;
    flex-direction: column;
    align-items:center;
    width:200px;
    box-shadow:0 2px 5px rgba(0,0,0,0.5);
    cursor:pointer;
    transition:transform 0.2s;
}
.woz:hover { transform:scale(1.05); }
.woz img {
    width:180px;
    height:120px;
    object-fit:cover;
    border-radius:6px;
    margin-bottom:10px;
}
.woz-info { display:flex; flex-direction: column; gap:5px; text-align:left; width:100%; }

.status { font-weight:bold; }

#pagination { display:flex; justify-content:center; gap:10px; margin-bottom:20px; flex-wrap:wrap; }
.page-btn { padding:8px 12px; border-radius:6px; border:none; cursor:pointer; background:#b30000; color:white; }
.page-btn.disabled { background:#555; cursor:default; }

#lightbox {
    display:none;
    position:fixed;
    inset:0;
    background: rgba(0,0,0,0.95);
    justify-content:center;
    align-items:center;
    z-index:1000;
}
#lightboxContent {
    background:#1a1a1a;
    display:flex;
    width:95%;
    max-width:1600px;
    height:95%;
    border-radius:15px;
    overflow:hidden;
    position:relative;
}
#lightboxImg { max-width:80%; max-height:100%; object-fit:contain; background:#000; }
#lightboxInfo { flex:1; overflow-y:auto; }
#lightboxTitle {
    background:#E60000;
    padding:15px;
    font-size:28px;
    text-align:center;
    font-weight:bold;
}
#lightboxDetails { padding:15px; }

.detail-row {
    display:flex;
    justify-content:space-between;
    border-bottom:1px solid rgba(255,255,255,0.2);
    padding:5px 0;
}
.detail-label { font-weight:bold; min-width:130px; }
.detail-value { flex-grow:1; }

#closeLightbox {
    position:absolute;
    top:10px;
    right:15px;
    font-size:32px;
    background:#b30000;
    border-radius:50%;
    width:40px;
    height:40px;
    display:flex;
    justify-content:center;
    align-items:center;
    cursor:pointer;
}

#prevBtn, #nextBtn {
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    font-size:40px;
    background:rgba(0,0,0,0.4);
    color:white;
    border:none;
    border-radius:50%;
    width:50px;
    height:50px;
    cursor:pointer;
}
#prevBtn { left:10px; }
#nextBtn { right:10px; }

.osp-link {
    text-decoration: underline;
    cursor: pointer;
    color: inherit;
}
</style>
</head>

<body>

<h1>ðŸš’ Baza wozÃ³w straÅ¼ackich</h1>

<input id="search" placeholder="Szukaj jednostki, ID, rejestracji, marki...">

<select id="filterWoj">
<option value="">Wszystkie wojewÃ³dztwa</option>
<option>Mazowieckie</option>
<option>MaÅ‚opolskie</option>
<option>Pomorskie</option>
<option>ÅšlÄ…skie</option>
</select>

<select id="sortBy">
<option value="ID">Sortuj po ID</option>
<option value="Jednostka">Sortuj po Jednostce</option>
<option value="Marka">Sortuj po Marce</option>
<option value="Rejestracja">Sortuj po Rejestracji</option>
<option value="Rok produkcji">Sortuj po Roku</option>
</select>

<select id="sortDir">
<option value="asc">RosnÄ…co</option>
<option value="desc">MalejÄ…co</option>
</select>

<div id="lista"></div>
<div id="pagination"></div>

<div id="lightbox">
<button id="prevBtn">&#8592;</button>
<div id="lightboxContent">
<span id="closeLightbox">&times;</span>
<img id="lightboxImg">
<div id="lightboxInfo">
<h2 id="lightboxTitle"></h2>
<div id="lightboxDetails"></div>
</div>
</div>
<button id="nextBtn">&#8594;</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<script>
const csvUrl = 'https://docs.google.com/spreadsheets/d/1-INf04fbUF_z3l7kUvIr4dm1lv7iJWMVmw-ICWbDfkI/export?format=csv';

let currentPage=1, itemsPerPage=80, filteredWozki=[], lightboxIndex=0, filterField=null;

Papa.parse(csvUrl,{
download:true, header:true, skipEmptyLines:true,
complete:r=>{ window.wozy=r.data; displayWozow(); }
});

function displayWozow(){
const lista=document.getElementById('lista');
const pagination=document.getElementById('pagination');
lista.innerHTML=''; pagination.innerHTML='';

const q=search.value.toLowerCase();
const woj=filterWoj.value;
const sortBy=sortBySelect.value;
const sortDir=sortDirSelect.value;

window.wozy.sort((a,b)=>{
const A=(a[sortBy]||'').toLowerCase();
const B=(b[sortBy]||'').toLowerCase();
return sortDir==='asc'
?A.localeCompare(B,undefined,{numeric:true})
:B.localeCompare(A,undefined,{numeric:true});
});

filteredWozki=window.wozy.filter(w=>{
let ok=!q ||
(filterField && (w[filterField]||'').toLowerCase().includes(q)) ||
(!filterField && Object.values(w).join(' ').toLowerCase().includes(q));
return ok && (!woj || w.WojewÃ³dztwo===woj);
});

const start=(currentPage-1)*itemsPerPage;
filteredWozki.slice(start,start+itemsPerPage).forEach((w,i)=>{
const d=document.createElement('div');
d.className='woz';
d.innerHTML=`<img src="${w.ZdjÄ™cie||''}">
<div class="woz-info">
<b>ID:</b> ${w.ID||'-'}
<b>Jednostka:</b> ${w.Jednostka||'-'}
<b>Marka:</b> ${w.Marka||'-'}
<b>Rok:</b> ${w['Rok produkcji']||'-'}
<b>Status:</b> ${w.Status||'-'}
</div>`;
d.onclick=()=>openLightbox(start+i);
lista.appendChild(d);
});

for(let i=1;i<=Math.ceil(filteredWozki.length/itemsPerPage);i++){
const b=document.createElement('button');
b.textContent=i;
b.className='page-btn'+(i===currentPage?' disabled':'');
b.onclick=()=>{currentPage=i;displayWozow()};
pagination.appendChild(b);
}
}

function openLightbox(i){
lightboxIndex=i;
const w=filteredWozki[i];
lightbox.style.display='flex';
lightboxImg.src=w.ZdjÄ™cie||'';
lightboxTitle.textContent=`${w.Marka||'-'} (${w.ID||''})`;
lightboxDetails.innerHTML='';

const clickable=['ID','Rejestracja','WojewÃ³dztwo','Powiat','Rok produkcji','Jednostka'];

[
['ðŸš¨ Podstawowe dane',['ID','Marka','Rok produkcji','Rejestracja','Typ']],
['ðŸ“ Lokalizacja',['Jednostka','WojewÃ³dztwo','Powiat']],
['âš¡ Status',['Status']],
['ðŸ“ Inne',['Inne']]
].forEach(sec=>{
const h=document.createElement('h3'); h.textContent=sec[0];
lightboxDetails.appendChild(h);

sec[1].forEach(f=>{
if(!w[f])return;
const row=document.createElement('div');
row.className='detail-row';

const label=document.createElement('div');
label.className='detail-label';
label.textContent=f;

const value=document.createElement('div');
value.className='detail-value';
value.textContent=w[f];

// klik z lightboxa
if(clickable.includes(f)){
value.style.textDecoration='underline';
value.style.cursor='pointer';
value.onclick=()=>{
search.value=w[f];
filterField=f;
currentPage=1;
displayWozow();
lightbox.style.display='none';
};
}

// INNE â†’ OSP/JRG/PSP/KSRG
if(f==='Inne'){
value.innerHTML=w[f].replace(
/\b(?:OSP|JRG|PSP|ZSP|WSP|LSRG|ZSR|KSRG)\s+[\w\sÄ…Ä™Å‚Å„Ã³Å›Å¼ÅºÄ‡-]+/gi,
m=>`<span class="osp-link">${m}</span>`
);
value.querySelectorAll('.osp-link').forEach(el=>{
el.onclick=()=>{
search.value=el.textContent.replace(/^(OSP|JRG|PSP|ZSP|WSP|LSRG|ZSR|KSRG)\s+/i,'');
filterField='Jednostka';
currentPage=1;
displayWozow();
lightbox.style.display='none';
};
});
}

row.append(label,value);
lightboxDetails.appendChild(row);
});
});
}

closeLightbox.onclick=()=>lightbox.style.display='none';
prevBtn.onclick=()=>openLightbox((lightboxIndex-1+filteredWozki.length)%filteredWozki.length);
nextBtn.onclick=()=>openLightbox((lightboxIndex+1)%filteredWozki.length);

search.oninput=()=>{currentPage=1;filterField=null;displayWozow()};
filterWoj.onchange=()=>{currentPage=1;displayWozow()};
</script>
</body>
</html>
