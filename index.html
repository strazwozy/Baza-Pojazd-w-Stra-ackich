<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title> Baza woz贸w stra偶ackich</title>
<style>
body { font-family: Arial; background:#f2f2f2; padding:20px; }
h1 { text-align: center; margin-bottom: 20px; }
#search, #filterWoj, #sortBy { margin:10px 5px; padding:5px; font-size: 16px; border-radius:5px; border:1px solid #ccc; }
#sortBy { background: #ff4d4d; color:white; border:none; }
#lista { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
.woz { background:white; padding:10px; border-radius:8px; display:flex; flex-direction: column; align-items: center; width: 200px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); cursor:pointer; }
.woz img { width: 180px; height: 120px; border-radius:6px; margin-bottom:10px; object-fit: cover; }
.woz-info { display:flex; flex-direction: column; gap:3px; text-align: left; width: 100%; }
.woz-info strong { display:inline-block; width: 90px; }

/* Lightbox */
#lightbox { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:1000; }
#lightboxContent { background:#cc0000; display:flex; max-width:900px; width:90%; border-radius:10px; overflow:hidden; color:white; }
#lightbox img { max-width:50%; object-fit: contain; }
#lightboxInfo { padding:20px; flex:1; display:flex; flex-direction:column; justify-content: space-between; }
#lightboxInfo h2 { margin:0 0 10px 0; }
#lightboxInfo div { margin: 5px 0; }
#closeLightbox { background:#333; color:white; border:none; padding:10px; border-radius:5px; cursor:pointer; margin-top:10px; width:100%; }
#prevBtn, #nextBtn { position:absolute; top:50%; transform:translateY(-50%); font-size:30px; color:white; background:rgba(0,0,0,0.5); border:none; padding:10px; cursor:pointer; border-radius:50%; }
#prevBtn { left:10px; }
#nextBtn { right:10px; }

/* Status colors */
.status-czynny { color:limegreen; }
.status-wycofany { color:red; }
.status-przeniesiony { color:yellow; }
.status-muzeum { color:deepskyblue; }
.status-sprzedany { color:red; }
.status-rozbity { color:red; }
.status-spalony { color:red; }
.status-porzucony { color:orange; }

/* Responsywno */
@media (max-width:600px){
    #lista { flex-direction: column; align-items: center; }
    #lightboxContent { flex-direction: column; max-width:90%; }
    #lightbox img { max-width:100%; }
}
</style>
</head>
<body>

<h1> Baza woz贸w stra偶ackich</h1>

<input type="text" id="search" placeholder="Szukaj jednostki, ID, rejestracji, marki...">
<select id="filterWoj">
  <option value="">Wszystkie wojew贸dztwa</option>
  <option value="Maopolskie">Maopolskie</option>
  <option value="Mazowieckie">Mazowieckie</option>
  <option value="Pomorskie">Pomorskie</option>
  <option value="Wielkopolskie">Wielkopolskie</option>
  <option value="Dolnolskie">Dolnolskie</option>
  <option value="lskie">lskie</option>
  <option value="贸dzkie">贸dzkie</option>
  <option value="Lubelskie">Lubelskie</option>
  <option value="Lubuskie">Lubuskie</option>
  <option value="Opolskie">Opolskie</option>
  <option value="Podkarpackie">Podkarpackie</option>
  <option value="Podlaskie">Podlaskie</option>
  <option value="witokrzyskie">witokrzyskie</option>
  <option value="Warmisko-Mazurskie">Warmisko-Mazurskie</option>
  <option value="Zachodniopomorskie">Zachodniopomorskie</option>
</select>

<select id="sortBy">
  <option value="ID">Sortuj po ID</option>
  <option value="Marka">Sortuj po marce</option>
  <option value="Jednostka">Sortuj po jednostce</option>
  <option value="Rejestracja">Sortuj po rejestracji</option>
  <option value="Rok produkcji">Sortuj po roku</option>
</select>

<div id="lista"></div>

<!-- Lightbox -->
<div id="lightbox">
    <button id="prevBtn">&#8592;</button>
    <div id="lightboxContent">
        <img id="lightboxImg" src="">
        <div id="lightboxInfo">
            <h2 id="lightboxTitle">Marka</h2>
            <div id="lightboxDetails"></div>
            <button id="closeLightbox">Zamknij</button>
        </div>
    </div>
    <button id="nextBtn">&#8594;</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<script>
const csvUrl = 'https://docs.google.com/spreadsheets/d/1-INf04fbUF_z3l7kUvIr4dm1lv7iJWMVmw-ICWbDfkI/export?format=csv';
const limitPerPage = 80;
let currentPage = 1;
let totalPages = 1;
let filteredWozki = [];
let currentLightboxIndex = 0;

Papa.parse(csvUrl, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(results){
        window.wozy = results.data;
        window.wozy.sort((a,b)=>Number(a.ID)-Number(b.ID));
        displayWozow();
    }
});

function getStatusClass(status){
    if(!status) return '';
    status = status.toLowerCase();
    if(status.includes('czynny')) return 'status-czynny';
    if(status.includes('wycofany')) return 'status-wycofany';
    if(status.includes('przeniesiony')) return 'status-przeniesiony';
    if(status.includes('muzeum')) return 'status-muzeum';
    if(status.includes('sprzedany')) return 'status-sprzedany';
    if(status.includes('rozbity')) return 'status-rozbity';
    if(status.includes('spon') || status.includes('spalony')) return 'status-spalony';
    if(status.includes('porzucony')) return 'status-porzucony';
    return '';
}

function displayWozow(){
    const lista = document.getElementById('lista');
    const search = document.getElementById('search').value.toLowerCase();
    const wojFilter = document.getElementById('filterWoj').value;
    const sortBy = document.getElementById('sortBy').value;
    lista.innerHTML='';

    filteredWozki = window.wozy.filter(w=>{
        return (
            (w.Jednostka && w.Jednostka.toLowerCase().includes(search)) ||
            (w.ID && w.ID.toString().includes(search)) ||
            (w.Rejestracja && w.Rejestracja.toLowerCase().includes(search)) ||
            (w.Marka && w.Marka.toLowerCase().includes(search))
        ) && (wojFilter === '' || w.Wojew贸dztwo === wojFilter);
    });

    filteredWozki.sort((a,b)=>{
        let valA = a[sortBy] || '';
        let valB = b[sortBy] || '';
        if(sortBy==='ID'||sortBy==='Rok produkcji') return Number(valA)-Number(valB);
        return valA.toString().localeCompare(valB.toString());
    });

    totalPages = Math.ceil(filteredWozki.length/limitPerPage);
    if(currentPage>totalPages) currentPage=totalPages;

    const start = (currentPage-1)*limitPerPage;
    const end = start+limitPerPage;
    filteredWozki.slice(start,end).forEach((w,i)=>{
        const div = document.createElement('div');
        div.className='woz';
        div.dataset.index = start+i;
        div.innerHTML=`
            <img src="${w.Zdjcie||'https://via.placeholder.com/180x120?text=Brak+zdjcia'}" alt="${w.Jednostka}">
            <div class="woz-info">
                <strong>ID:</strong> ${w.ID||'-'}
                <strong>Jednostka:</strong> ${w.Jednostka||'-'}
                <strong>Wojew贸dztwo:</strong> ${w.Wojew贸dztwo||'-'}
                <strong>Powiat:</strong> ${w.Powiat||'-'}
                <strong>Marka:</strong> ${w.Marka||'-'}
                <strong>Rok:</strong> ${w['Rok produkcji']||'-'}
                <strong>Status:</strong> <span class="${getStatusClass(w.Status)}">${w.Status||'-'}</span>
                <strong>Rejestracja:</strong> ${w.Rejestracja||'-'}
                <strong>Inne:</strong> ${w.Inne||'-'}
            </div>
        `;
        div.addEventListener('click', ()=>openLightbox(start+i));
        lista.appendChild(div);
    });
}

// eventy
document.getElementById('search').addEventListener('input', ()=>{currentPage=1; displayWozow();});
document.getElementById('filterWoj').addEventListener('change', ()=>{currentPage=1; displayWozow();});
document.getElementById('sortBy').addEventListener('change', ()=>{currentPage=1; displayWozow();});

// Lightbox
const lightbox = document.getElementById('lightbox');
const lightboxImg = document.getElementById('lightboxImg');
const lightboxTitle = document.getElementById('lightboxTitle');
const lightboxDetails = document.getElementById('lightboxDetails');

function openLightbox(index){
    if(index<0 || index>=filteredWozki.length) return;
    currentLightboxIndex=index;
    const w = filteredWozki[index];
    lightboxImg.src=w.Zdjcie||'https://via.placeholder.com/400x300?text=Brak+zdjcia';
    lightboxTitle.innerHTML = ` ${w.Marka||'-'}`;
    lightboxDetails.innerHTML = `
        ID: ${w.ID||'-'}<br>
        Jednostka: ${w.Jednostka||'-'}<br>
        Wojew贸dztwo: ${w.Wojew贸dztwo||'-'}<br>
        Powiat: ${w.Powiat||'-'}<br>
        Rok: ${w['Rok produkcji']||'-'}<br>
        Status: <span class="${getStatusClass(w.Status)}">${w.Status||'-'}</span><br>
        Rejestracja: ${w.Rejestracja||'-'}<br>
        Inne: ${w.Inne||'-'}
    `;
    lightbox.style.display='flex';
}

document.getElementById('closeLightbox').addEventListener('click', ()=>lightbox.style.display='none');
document.getElementById('prevBtn').addEventListener('click', ()=>{openLightbox(currentLightboxIndex-1);});
document.getElementById('nextBtn').addEventListener('click', ()=>{openLightbox(currentLightboxIndex+1);});
</script>

</body>
</html>

