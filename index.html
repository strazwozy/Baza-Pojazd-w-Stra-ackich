<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Baza Pojazdów Strażackich</title>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 0;
    background: #f4f4f4;
}

header {
    background: #b30000;
    color: #fff;
    padding: 15px;
    text-align: center;
    font-size: 22px;
    font-weight: bold;
}

#controls {
    padding: 10px;
    background: #fff;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

#list {
    padding: 10px;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 10px;
}

.card {
    background: #fff;
    padding: 10px;
    border-radius: 6px;
    cursor: pointer;
    box-shadow: 0 2px 5px rgba(0,0,0,.1);
}

.card img {
    width: 100%;
    border-radius: 4px;
}

.card .id {
    background: #b30000;
    color: #fff;
    padding: 4px 6px;
    font-weight: bold;
    margin-bottom: 5px;
    display: inline-block;
}

.card .meta {
    font-size: 14px;
}

#pagination {
    text-align: center;
    padding: 15px;
}

.page-btn {
    margin: 2px;
    padding: 5px 10px;
    cursor: pointer;
}

.page-btn.disabled {
    opacity: .5;
    pointer-events: none;
}

/* LIGHTBOX */
#lightbox {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.7);
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

#lightbox-content {
    background: #fff;
    max-width: 800px;
    width: 95%;
    max-height: 90vh;
    overflow-y: auto;
    padding: 15px;
    border-radius: 8px;
}

.lb-header {
    background: #b30000;
    color: #fff;
    padding: 10px;
    font-size: 20px;
    margin-bottom: 10px;
}

.lb-section {
    margin-bottom: 15px;
}

.lb-section h3 {
    border-bottom: 2px solid #ddd;
    padding-bottom: 4px;
}

.lb-row {
    display: flex;
    gap: 10px;
    margin: 4px 0;
}

.lb-label {
    width: 140px;
    font-weight: bold;
}

.lb-value {
    flex: 1;
}

.osp-link {
    cursor: pointer;
    text-decoration: underline;
    color: inherit;
}

.close-btn {
    float: right;
    cursor: pointer;
    font-weight: bold;
}
</style>
</head>

<body>

<header>Baza Pojazdów Strażackich</header>

<div id="controls">
    <input id="search" placeholder="Szukaj...">
    <select id="sortBy">
        <option value="ID">ID</option>
        <option value="Marka">Marka</option>
        <option value="Rok produkcji">Rok</option>
        <option value="Jednostka">Jednostka</option>
    </select>
    <select id="sortDir">
        <option value="asc">⬆ Rosnąco</option>
        <option value="desc">⬇ Malejąco</option>
    </select>
</div>

<div id="list"></div>
<div id="pagination"></div>

<!-- LIGHTBOX -->
<div id="lightbox">
    <div id="lightbox-content">
        <div class="lb-header">
            <span id="lb-title"></span>
            <span class="close-btn" onclick="closeLightbox()">✖</span>
        </div>
        <div id="lb-details"></div>
    </div>
</div>

<script>
// ===============================
// DANE (tu normalnie masz arkusz)
// ===============================
window.wozy = [
    {
        ID: "569M67",
        Marka: "Scania",
        "Rok produkcji": "2015",
        Jednostka: "OSP Cendrowice",
        Województwo: "Mazowieckie",
        Powiat: "Piaseczyński",
        Status: "Czynny",
        Typ: "GCBA",
        Rejestracja: "WPI 12345",
        Inne: "Wóz trafił na przetarg w 2025 roku – dawniej należał do OSP Wojciechowice oraz OSP Cendrowice",
        Zdjecie: "https://via.placeholder.com/400"
    }
];

// ===============================
// ZMIENNE GLOBALNE
// ===============================
let currentPage = 1;
const perPage = 80;
let filterField = null;

// ===============================
// RENDER LISTY
// ===============================
function displayWozow() {
    const list = document.getElementById('list');
    const pagination = document.getElementById('pagination');
    list.innerHTML = '';
    pagination.innerHTML = '';

    let data = [...window.wozy];

    const search = document.getElementById('search').value.toLowerCase();
    if (search) {
        data = data.filter(w =>
            Object.values(w).join(' ').toLowerCase().includes(search)
        );
    }

    const sortBy = document.getElementById('sortBy').value;
    const dir = document.getElementById('sortDir').value;

    data.sort((a,b)=>{
        let A = a[sortBy] || '';
        let B = b[sortBy] || '';
        if(sortBy==='ID'){
            A=parseInt(A)||0; B=parseInt(B)||0;
        }
        return dir==='asc' ? A>B?1:-1 : A<B?1:-1;
    });

    const totalPages = Math.ceil(data.length / perPage);
    const start = (currentPage-1)*perPage;
    const pageData = data.slice(start, start+perPage);

    pageData.forEach(w=>{
        const card = document.createElement('div');
        card.className='card';
        card.innerHTML = `
            <div class="id">${w.ID}</div>
            <img src="${w.Zdjecie}">
            <div class="meta">
                ${w.Jednostka}<br>
                ${w.Marka} ${w["Rok produkcji"]}<br>
                ${w.Status}
            </div>
        `;
        card.onclick=()=>openLightbox(w);
        list.appendChild(card);
    });

    for(let i=1;i<=totalPages;i++){
        const b=document.createElement('button');
        b.textContent=i;
        b.className='page-btn'+(i===currentPage?' disabled':'');
        b.onclick=()=>{currentPage=i;displayWozow();}
        pagination.appendChild(b);
    }
}

// ===============================
// LIGHTBOX
// ===============================
function openLightbox(w){
    document.getElementById('lb-title').textContent =
        `${w.Marka} (${w.ID})`;

    const lb = document.getElementById('lb-details');
    lb.innerHTML='';

    const sections = {
        "Podstawowe dane": ["ID","Marka","Rok produkcji","Rejestracja","Typ"],
        "Lokalizacja": ["Jednostka","Województwo","Powiat"],
        "Status": ["Status"],
        "Inne": ["Inne"]
    };

    Object.entries(sections).forEach(([title,fields])=>{
        const sec=document.createElement('div');
        sec.className='lb-section';
        sec.innerHTML=`<h3>${title}</h3>`;

        fields.forEach(f=>{
            const row=document.createElement('div');
            row.className='lb-row';

            const label=document.createElement('div');
            label.className='lb-label';
            label.textContent=f;

            const value=document.createElement('div');
            value.className='lb-value';

            if(f==="Inne"){
                value.innerHTML = (w[f]||'').replace(
                    /\b(OSP|JRG|PSP|ZSP|WSP|LSRG|ZSR|KSRG)\s+[A-Za-zĄĆĘŁŃÓŚŻŹąęłńóśżź\s-]+/gi,
                    m=>`<span class="osp-link">${m}</span>`
                );
                value.querySelectorAll('.osp-link').forEach(el=>{
                    el.onclick=()=>{
                        document.getElementById('search').value=el.textContent;
                        filterField='Jednostka';
                        currentPage=1;
                        closeLightbox();
                        displayWozow();
                    }
                });
            } else {
                value.textContent = w[f]||'—';
                value.onclick=()=>{
                    document.getElementById('search').value=w[f];
                    filterField=f;
                    currentPage=1;
                    closeLightbox();
                    displayWozow();
                }
                value.style.cursor='pointer';
                value.style.textDecoration='underline';
            }

            row.append(label,value);
            sec.appendChild(row);
        });

        lb.appendChild(sec);
    });

    document.getElementById('lightbox').style.display='flex';
}

function closeLightbox(){
    document.getElementById('lightbox').style.display='none';
}

// ===============================
displayWozow();
</script>

</body>
</html>

