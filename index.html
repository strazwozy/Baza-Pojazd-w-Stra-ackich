<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>üöí Baza woz√≥w stra≈ºackich</title>

<style>
body {
    font-family: Arial, sans-serif;
    background:#f2f2f2;
    padding:20px;
    margin:0;
}

h1 {
    text-align:center;
    margin-bottom:20px;
}

#controls {
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    justify-content:center;
    margin-bottom:20px;
}

#controls input, #controls select {
    padding:8px;
    font-size:16px;
}

#lista {
    display:flex;
    flex-wrap:wrap;
    gap:15px;
    justify-content:center;
}

.woz {
    background:white;
    padding:10px;
    border-radius:10px;
    width:200px;
    box-shadow:0 2px 5px rgba(0,0,0,0.2);
    cursor:pointer;
    display:flex;
    flex-direction:column;
    align-items:center;
}

.woz img {
    width:180px;
    height:120px;
    object-fit:cover;
    border-radius:8px;
    margin-bottom:8px;
}

.woz-info {
    width:100%;
    font-size:14px;
    display:flex;
    flex-direction:column;
    gap:4px;
}

.status-czynny { color:green; font-weight:bold; }
.status-wycofany,
.status-sprzedany,
.status-rozbity,
.status-sp≈ÇonƒÖ≈Ç { color:red; font-weight:bold; }
.status-przeniesiony { color:goldenrod; font-weight:bold; }
.status-muzeum { color:deepskyblue; font-weight:bold; }
.status-porzucony { color:orange; font-weight:bold; }

/* PAGINACJA */
#pagination {
    margin:30px 0;
    display:flex;
    justify-content:center;
    align-items:center;
    gap:15px;
}

#pagination button {
    background:#1a1a1a;
    color:white;
    border:1px solid #444;
    padding:8px 16px;
    font-size:16px;
    border-radius:8px;
    cursor:pointer;
}

#pagination button:disabled {
    opacity:0.4;
    cursor:not-allowed;
}

/* LIGHTBOX */
#lightbox {
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.9);
    z-index:1000;
    justify-content:center;
    align-items:center;
}

#lightboxContent {
    width:95%;
    height:90%;
    background:#1a1a1a;
    display:flex;
    border-radius:16px;
    overflow:hidden;
    position:relative;
    color:white;
}

#lightboxLeft {
    flex:1.2;
    display:flex;
    justify-content:center;
    align-items:center;
    background:black;
}

#lightboxLeft img {
    max-width:100%;
    max-height:100%;
    object-fit:contain;
}

#lightboxRight {
    flex:1;
    padding:20px;
    overflow-y:auto;
}

#lightboxTitle {
    background:#E60000;
    padding:15px;
    font-size:26px;
    text-align:center;
    border-radius:10px;
    margin-bottom:15px;
}

.detail-row {
    display:flex;
    justify-content:space-between;
    padding:8px 0;
    border-bottom:1px solid rgba(255,255,255,0.2);
}

.detail-label { font-weight:bold; }

#closeLightbox {
    position:absolute;
    top:15px;
    right:20px;
    font-size:32px;
    background:none;
    border:none;
    color:white;
    cursor:pointer;
}

#prevBtn, #nextBtn {
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    font-size:50px;
    background:rgba(0,0,0,0.4);
    border:none;
    color:white;
    cursor:pointer;
    padding:15px;
    border-radius:50%;
}

#prevBtn { left:10px; }
#nextBtn { right:10px; }

@media(max-width:900px){
    #lightboxContent {
        flex-direction:column;
    }
    #lightboxLeft {
        height:50%;
    }
}
</style>
</head>

<body>

<h1>üöí Baza woz√≥w stra≈ºackich</h1>

<div id="controls">
    <input type="text" id="search" placeholder="Szukaj ID / jednostka / marka / rejestracja">
    <select id="sort">
        <option value="ID">ID</option>
        <option value="Marka">Marka</option>
        <option value="Jednostka">Jednostka</option>
        <option value="Rok produkcji">Rok produkcji</option>
        <option value="Rejestracja">Rejestracja</option>
    </select>
</div>

<div id="lista"></div>

<div id="pagination">
    <button id="prevPage">‚Üê Poprzednia</button>
    <span id="pageInfo"></span>
    <button id="nextPage">Nastƒôpna ‚Üí</button>
</div>

<!-- LIGHTBOX -->
<div id="lightbox">
    <div id="lightboxContent">
        <button id="closeLightbox">√ó</button>
        <button id="prevBtn">‚Äπ</button>
        <button id="nextBtn">‚Ä∫</button>

        <div id="lightboxLeft">
            <img id="lightboxImg">
        </div>
        <div id="lightboxRight">
            <div id="lightboxTitle"></div>
            <div id="lightboxDetails"></div>
        </div>
    </div>
</div>

<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/1-INf04fbUF_z3l7kUvIr4dm1lv7iJWMVmw-ICWbDfkI/pub?output=csv";

let wozki = [];
let filteredWozki = [];
let currentPage = 1;
const itemsPerPage = 80;
let currentIndex = 0;

fetch(csvUrl)
.then(res => res.text())
.then(text => {
    const rows = text.split("\n").map(r => r.split(","));
    const headers = rows.shift();
    wozki = rows.map(r => Object.fromEntries(headers.map((h,i)=>[h.trim(), (r[i]||"").trim()])));
    filteredWozki = [...wozki];
    displayWozow();
});

function displayWozow(){
    const lista = document.getElementById("lista");
    lista.innerHTML = "";

    const start = (currentPage-1)*itemsPerPage;
    const end = start+itemsPerPage;
    const pageItems = filteredWozki.slice(start,end);

    pageItems.forEach((w,i)=>{
        const div = document.createElement("div");
        div.className="woz";
        div.innerHTML=`
            <img src="${w.Zdjƒôcie || 'https://via.placeholder.com/180x120'}">
            <div class="woz-info">
                <strong>ID:</strong> ${w.ID}
                <strong>Jednostka:</strong> ${w.Jednostka}
                <strong>Marka:</strong> ${w.Marka}
                <strong class="status-${(w.Status||'').toLowerCase().replace(/ /g,'')}">${w.Status||''}</strong>
            </div>`;
        div.onclick=()=>openLightbox(start+i);
        lista.appendChild(div);
    });

    updatePagination();
}

function updatePagination(){
    const total = Math.ceil(filteredWozki.length/itemsPerPage);
    document.getElementById("pageInfo").textContent = `Strona ${currentPage} / ${total}`;
    prevPage.disabled = currentPage===1;
    nextPage.disabled = currentPage===total;
}

prevPage.onclick=()=>{ if(currentPage>1){currentPage--;displayWozow();}};
nextPage.onclick=()=>{ const t=Math.ceil(filteredWozki.length/itemsPerPage); if(currentPage<t){currentPage++;displayWozow();}};

search.oninput=()=>{
    const q = search.value.toLowerCase();
    filteredWozki = wozki.filter(w =>
        (w.ID||'').toLowerCase().includes(q) ||
        (w.Jednostka||'').toLowerCase().includes(q) ||
        (w.Marka||'').toLowerCase().includes(q) ||
        (w.Rejestracja||'').toLowerCase().includes(q)
    );
    currentPage=1;
    displayWozow();
};

sort.onchange=()=>{
    const f = sort.value;
    filteredWozki.sort((a,b)=>(a[f]||"").localeCompare(b[f]||""));
    currentPage=1;
    displayWozow();
};

/* LIGHTBOX */
function openLightbox(i){
    currentIndex=i;
    const w = filteredWozki[i];
    lightbox.style.display="flex";
    lightboxImg.src=w.Zdjƒôcie;
    lightboxTitle.innerHTML=`üöí ${w.Marka}`;
    lightboxDetails.innerHTML=Object.entries(w).map(([k,v])=>`
        <div class="detail-row">
            <div class="detail-label">${k}</div>
            <div>${v||'-'}</div>
        </div>`).join("");
}

closeLightbox.onclick=()=>lightbox.style.display="none";
prevBtn.onclick=()=>{ if(currentIndex>0) openLightbox(currentIndex-1); };
nextBtn.onclick=()=>{ if(currentIndex<filteredWozki.length-1) openLightbox(currentIndex+1); };

document.addEventListener("keydown",e=>{
    if(lightbox.style.display!=="flex") return;
    if(e.key==="Escape") closeLightbox.click();
    if(e.key==="ArrowLeft") prevBtn.click();
    if(e.key==="ArrowRight") nextBtn.click();
});
</script>

</body>
</html>
